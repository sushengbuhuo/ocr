!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):t(e.Vue)}(this,function(e){"use strict";function t(e,t){function n(n){return function(a){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(i=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(i=i.call(r,n[1])).done)return i;switch(r=0,i&&(n=[0,i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],r=0}finally{o=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var o,r,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}function n(e){return Object.prototype.toString.call(e).match(/\[\w+\s(\w+)\]/)[1].toLowerCase()}e=e&&e.hasOwnProperty("default")?e.default:e;var o="https://api.geeku.net/ocr",r={image:"",url:"",language_type:"CHN_ENG",detect_direction:!0,detect_language:!0,probability:!0},i=/https?:\/\/.*?/,a=function(){function e(t){if(this._file=null,this._url="",this.imgReader=new FileReader,this.img=new Image,this.config=null,this.token="",this.eventListeners={},!(this instanceof e))throw new Error("This is not a JsOCR instance.");if(!/image\/(png)|(jpg)|(jpeg)|(bmp)/i.test(t.type))throw new Error("Image format("+t.type+") is not supported. Image format must be PNG, JPG or BMP.");this.config=Object.assign(r);var o=localStorage.getItem("token");this.token=o||null;switch(n(t)){case"file":this.file=t;break;case"event":this.file=t.target.files[0];break;case"htmlinputelement":this.addChangeEvent(t);break;case"string":this.url=t;break;default:throw Error("Parament type is illegal.")}}return Object.defineProperty(e.prototype,"file",{get:function(){return this._file},set:function(e){if(e.size>=4194304)throw new Error("Image is oversize.");console.dir(this.file),this._file=e,this.run()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},set:function(e){if(!i.test(e))throw new Error("Url format illegal.");this._url=e,this.run("url")},enumerable:!0,configurable:!0}),e.prototype.run=function(e){return void 0===e&&(e="img"),function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((o=o.apply(e,t||[])).next())})}(this,void 0,void 0,function(){var n,r,i,a,s,c=this;return t(this,function(t){switch(t.label){case 0:return n=null,"img"!==e?[3,2]:[4,this.img2Base64(this._file)];case 1:return n=t.sent(),this.config.image=n.replace(/data:image\/\w+;base64,/,""),this.config.url=void 0,[3,3];case 2:"url"===e&&(this.config.image=void 0,this.config.url=this.url),t.label=3;case 3:return console.log(this.config),r=Object.keys(this.config).filter(function(e){return c.config[e]}).map(function(e){return e+"="+encodeURIComponent(c.config[e])}).join("&"),(i=new Headers).append("Content-Type","application/x-www-form-urlencoded"),this.token?[3,5]:(a=this,[4,fetch("https://api.geeku.net/baidu/ocrToken/").then(function(e){return e.text()}).then(function(e){return e})]);case 4:a.token=t.sent(),t.label=5;case 5:return s=fetch(o+"?access_token="+this.token,{method:"POST",headers:i,body:r}).then(function(e){return e.json()}).then(function(e){if(e.error_code)throw new Error("ERROR: "+e.error_code+": "+e.error_msg);c.eventListeners.data&&c.eventListeners.data.forEach(function(t){return t.call(null,e.words_result)}),localStorage&&localStorage.setItem("jsocrHistory",JSON.stringify({img:c.config.url?c.config.url:c.config.image,data:e}))}),[2]}})})},e.prototype.on=function(e,t){this.eventListeners[e]?this.eventListeners[e].push(t):this.eventListeners[e]=[t]},e.prototype.addChangeEvent=function(e){var t=this;e.addEventListener("change",function(e){t.file=e.target.files[0]})},e.prototype.img2Base64=function(e){var t=this;return this.img.crossOrigin="anonymous",new Promise(function(n,o){t.imgReader.onload=function(e){t.img.src=e.target.result,n(e.target.result)},t.imgReader.readAsDataURL(e)})},e}(),s={copy:"https://cdn.bootcss.com/clipboard.js/1.7.1/clipboard.min.js"},c=document.body;new e({el:"main",data:{showContent:!1,showLoading:!1,showAlert:!1,alertMsg:"",token:localStorage.getItem("token"),imgSrc:null,content:"",flags:{enableCopy:!0}},methods:{clickClose:function(e){console.log(e),this.showContent=!1},clickUpload:function(){this.upload(this.$refs.inputField.files[0]),this.$refs.inputField.value=""},upload:function(e){var t=this,n=null;try{n=new a(e)}catch(e){return void alert(e)}this.showLoading=!0,n.on("data",function(o){t.imgSrc="string"==typeof e?e:n.img.src,t.content=o.map(function(e){return e.words}).join("\n"),t.showContent=!0,t.showLoading=!1})},saveToken:function(){localStorage.getItem("token")!==this.token?(localStorage.setItem("token",this.token),this.alert("Token saved.")):this.alert("Nothing change.")},alert:function(e){var t=this;this.showAlert=!0,this.alertMsg=e,window.setTimeout(function(){t.showAlert=!1},3e3)},scriptCB:function(t){var n=this;switch(t){case"copy":e.nextTick(function(){var e=new Clipboard(".copy");e.on("success",function(e){n.alert("Copy Successful."),e.clearSelection()}),e.on("error",function(e){n.alert("Copy Failed, please copy by ctrl/command+c/v.")})})}}},computed:{},created:function(){var e=this;Object.keys(this.flags).forEach(function(t){var n=t.replace("enable","").toLowerCase();e.flags[t]&&function(e,t){var n=document.querySelector("head"),o=document.createElement("script");o.src=e,t&&(o.onload=t),n.appendChild(o)}(s[n],function(){e.scriptCB(n)})}),document.addEventListener("paste",function(t){var o=t.clipboardData.getData("text");"file"===n(t.clipboardData.files[0])?e.upload(t.clipboardData.files[0]):i.test(o)&&(console.log(o),e.upload(o))}),document.addEventListener("dragover",function(e){e.preventDefault(),c.classList.add("dragover")}),document.addEventListener("dragleave",function(e){e.preventDefault(),c.classList.remove("dragover")}),document.addEventListener("drop",function(t){t.preventDefault(),e.upload(t.dataTransfer.files[0]),c.classList.remove("dragover")})}})});
