!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.JsOCR={})}(this,function(e){"use strict";function t(e,t){function n(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){a.label=n[1];break}if(6===n[0]&&a.label<o[1]){a.label=o[1],o=n;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}var r,i,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s}function n(e){return Object.prototype.toString.call(e).match(/\[\w+\s(\w+)\]/)[1].toLowerCase()}var r="https://api.geeku.net/ocr",i={image:"",url:"",language_type:"CHN_ENG",detect_direction:!0,detect_language:!0,probability:!0},o=/https?:\/\/.*?/,s=function(){function e(t){if(this._file=null,this._url="",this.imgReader=new FileReader,this.img=new Image,this.config=null,this.token="",this.eventListeners={},!(this instanceof e))throw new Error("This is not a JsOCR instance.");if(!/image\/(png)|(jpg)|(jpeg)|(bmp)/i.test(t.type))throw new Error("Image format("+t.type+") is not supported. Image format must be PNG, JPG or BMP.");this.config=Object.assign(i);var r=localStorage.getItem("token");this.token=r||"24.2f0d9a3b6a60817dfd94ae61ea6f7e99.2592000.1515124116.282335-10488404";switch(n(t)){case"file":this.file=t;break;case"event":this.file=t.target.files[0];break;case"htmlinputelement":this.addChangeEvent(t);break;case"string":this.url=t;break;default:throw Error("Parament type is illegal.")}}return Object.defineProperty(e.prototype,"file",{get:function(){return this._file},set:function(e){if(e.size>=4194304)throw new Error("Image is oversize.");console.dir(this.file),this._file=e,this.run()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},set:function(e){if(!o.test(e))throw new Error("Url format illegal.");this._url=e,this.run("url")},enumerable:!0,configurable:!0}),e.prototype.run=function(e){return void 0===e&&(e="img"),function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function(){var n,i,o,s,a=this;return t(this,function(t){switch(t.label){case 0:return n=null,"img"!==e?[3,2]:[4,this.img2Base64(this._file)];case 1:return n=t.sent(),this.config.image=n.replace(/data:image\/\w+;base64,/,""),this.config.url=void 0,[3,3];case 2:"url"===e&&(this.config.image=void 0,this.config.url=this.url),t.label=3;case 3:return console.log(this.config),i=Object.keys(this.config).filter(function(e){return a.config[e]}).map(function(e){return e+"="+encodeURIComponent(a.config[e])}).join("&"),(o=new Headers).append("Content-Type","application/x-www-form-urlencoded"),s=fetch(r+"?access_token="+this.token,{method:"POST",headers:o,body:i}).then(function(e){return e.json()}).then(function(e){if(e.error_code)throw new Error("ERROR: "+e.error_code+": "+e.error_msg);a.eventListeners.data&&a.eventListeners.data.forEach(function(t){return t.call(null,e.words_result)}),localStorage&&localStorage.setItem("jsocrHistory",JSON.stringify({img:a.config.url?a.config.url:a.config.image,data:e}))}),[2]}})})},e.prototype.on=function(e,t){this.eventListeners[e]?this.eventListeners[e].push(t):this.eventListeners[e]=[t]},e.prototype.addChangeEvent=function(e){var t=this;e.addEventListener("change",function(e){t.file=e.target.files[0]})},e.prototype.img2Base64=function(e){var t=this;return this.img.crossOrigin="anonymous",new Promise(function(n,r){t.imgReader.onload=function(e){t.img.src=e.target.result,n(e.target.result)},t.imgReader.readAsDataURL(e)})},e}();e.toType=n,e.urlRegex=o,e.default=s,Object.defineProperty(e,"__esModule",{value:!0})});
